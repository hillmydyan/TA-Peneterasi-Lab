{% extends "layout/base.html" %}

{% block title %}DNS Spoofing Simulation - Virtual Pen Test Lab{% endblock %}

{% block content %}
<div class="p-4">
    <div class="flex flex-col md:flex-row justify-between items-center mb-6">
        <div>
            <h1 class="text-3xl font-bold">DNS Spoofing Simulation</h1>
            <p class="text-base-content/70">Simulasi serangan DNS Spoofing untuk membelokkan traffic korban.</p>
        </div>
    </div>

    <div class="flex flex-col lg:flex-row gap-6">
        <!-- LEFT COLUMN: STEPS -->
        <aside class="w-full lg:w-1/3">
            <div class="card bg-base-100 shadow-xl">
                <div class="card-body p-4">
                    <h3 class="card-title text-lg mb-4">Guide Instructions</h3>

                    <div class="space-y-4">
                        <div class="collapse collapse-arrow border border-base-300 bg-base-100 rounded-box">
                            <input type="checkbox" checked="checked" />
                            <div class="collapse-title text-xl font-medium">
                                1. Start Virtual Machines
                            </div>
                            <div class="collapse-content">
                                <p>Nyalakan VM Attacker dan Victim. Pastikan keduanya berada dalam satu jaringan
                                    internal yang sama.</p>
                            </div>
                        </div>

                        <div class="collapse collapse-arrow border border-base-300 bg-base-100 rounded-box">
                            <input type="checkbox" />
                            <div class="collapse-title text-xl font-medium">
                                2. Network Check
                            </div>
                            <div class="collapse-content">
                                <p>Cek IP address dan konektivitas (ping):</p>
                                <div class="mockup-code bg-base-300 text-base-content mt-2">
                                    <pre data-prefix="$"><code>ip a</code></pre>
                                </div>
                                <div class="mockup-code bg-base-300 text-base-content mt-2">
                                    <pre data-prefix="$"><code>ping &lt;victim_ip&gt;</code></pre>
                                </div>
                            </div>
                        </div>

                        <div class="collapse collapse-arrow border border-base-300 bg-base-100 rounded-box">
                            <input type="checkbox" />
                            <div class="collapse-title text-xl font-medium">
                                3. Enable IP Forwarding
                            </div>
                            <div class="collapse-content">
                                <p>Aktifkan forwarding agar traffic tetap bisa lewat (agar korban tidak curiga putus
                                    koneksi):</p>
                                <div class="mockup-code bg-base-300 text-base-content mt-2 max-w-full overflow-x-auto">
                                    <pre data-prefix="$"><code>echo 1 > /proc/sys/net/ipv4/ip_forward</code></pre>
                                </div>
                            </div>
                        </div>

                        <div class="collapse collapse-arrow border border-base-300 bg-base-100 rounded-box">
                            <input type="checkbox" />
                            <div class="collapse-title text-xl font-medium">
                                4. ARP Spoofing
                            </div>
                            <div class="collapse-content">
                                <p>Lakukan ARP poisoning (Man-in-the-Middle) dua arah:</p>
                                <div class="mockup-code bg-base-300 text-base-content mt-2 max-w-full overflow-x-auto">
                                    <pre
                                        data-prefix="$"><code>arpspoof -i eth0 -t &lt;victim_ip&gt; &lt;gateway_ip&gt;</code></pre>
                                </div>
                                <div class="mockup-code bg-base-300 text-base-content mt-2 max-w-full overflow-x-auto">
                                    <pre
                                        data-prefix="$"><code>arpspoof -i eth0 -t &lt;gateway_ip&gt; &lt;victim_ip&gt;</code></pre>
                                </div>
                            </div>
                        </div>

                        <div class="collapse collapse-arrow border border-base-300 bg-base-100 rounded-box">
                            <input type="checkbox" />
                            <div class="collapse-title text-xl font-medium">
                                5. DNS Spoofing
                            </div>
                            <div class="collapse-content">
                                <p>Buat file <code>dns.txt</code> berisi mapping domain palsu:</p>
                                <div class="mockup-code bg-base-300 text-base-content mt-2 max-w-full overflow-x-auto">
                                    <pre data-prefix="$"><code>echo "facebook.com 192.168.56.100" > dns.txt</code></pre>
                                </div>
                                <p class="mt-4">Jalankan dnsspoof:</p>
                                <div class="mockup-code bg-base-300 text-base-content mt-2 max-w-full overflow-x-auto">
                                    <pre data-prefix="$"><code>dnsspoof -i eth0 -f dns.txt</code></pre>
                                </div>
                            </div>
                        </div>

                        <div class="collapse collapse-arrow border border-base-300 bg-base-100 rounded-box">
                            <input type="checkbox" />
                            <div class="collapse-title text-xl font-medium">
                                6. Verification
                            </div>
                            <div class="collapse-content">
                                <p>Buka browser di Victim VM dan akses <code>facebook.com</code>. Halaman seharusnya
                                    mengarah ke server attacker (192.168.56.100).</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- RIGHT COLUMN: VM PREVIEW -->
        <main class="w-full lg:w-2/3">
            <div class="grid grid-cols-1 gap-6">
                <!-- Attacker Box -->
                <div class="card bg-base-100 shadow-xl">
                    <div class="card-body p-4">
                        <h3 class="card-title text-sm mb-2">Attacker VM (Kali Linux)</h3>
                        <div id="attacker-vm-container"
                            class="bg-base-300 h-96 rounded-box flex items-center justify-center relative overflow-hidden">
                            <div class="text-center text-base-content/50">
                                <p>VM is ready</p>
                            </div>
                        </div>
                        <div class="card-actions justify-center mt-4">
                            <button class="btn btn-primary btn-sm"
                                onclick="startVM('attacker-vm-container', '{{ attacker_url }}', 'dns-spoofing', 'attacker')">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <polygon points="5 3 19 12 5 21 5 3"></polygon>
                                </svg>
                                Start VM
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Victim Box -->
                <div class="card bg-base-100 shadow-xl">
                    <div class="card-body p-4">
                        <h3 class="card-title text-sm mb-2">Victim VM (Windows/Linux)</h3>
                        <div id="target-vm-container"
                            class="bg-base-300 h-96 rounded-box flex items-center justify-center relative overflow-hidden">
                            <div class="text-center text-base-content/50">
                                <p>VM is ready</p>
                            </div>
                        </div>
                        <div class="card-actions justify-center mt-4 gap-2">
                            <button class="btn btn-primary btn-sm"
                                onclick="startVM('target-vm-container', '{{ target_url }}', 'dns-spoofing')">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <polygon points="5 3 19 12 5 21 5 3"></polygon>
                                </svg>
                                Start VM
                            </button>
                            <button class="btn btn-warning btn-sm" onclick="resetVM('dns-spoofing')">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path>
                                    <path d="M3 3v5h5"></path>
                                </svg>
                                Reset VM
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>
{% endblock %}