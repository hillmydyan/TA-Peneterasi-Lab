{% extends "layout/base.html" %}

{% block title %}Network Sniffing Simulation - Virtual Pen Test Lab{% endblock %}

{% block content %}
<div class="page-header">
    <div class="d-flex justify-content-between align-items-center">
        <div>
            <h1 class="page-title">Network Sniffing Simulation</h1>
            <p class="page-subtitle">Simulasi serangan Network Sniffing untuk memonitor traffic jaringan.</p>
        </div>
        <div class="vm-status status-active">
            Lab Active
        </div>
    </div>
</div>

<div class="lab-layout">
    <!-- LEFT COLUMN: STEPS -->
    <aside class="lab-steps">
        <h3 class="card-title">Guide Instructions</h3>
        <div class="steps-container">

            <div class="step-item">
                <button class="step-title" onclick="toggleStep('step1')">
                    1. Start Virtual Machines
                </button>
                <div id="step1" class="step-content open">
                    <p>Nyalakan VM Attacker dan Victim. Pastikan keduanya berjalan lancar.</p>
                </div>
            </div>

            <div class="step-item">
                <button class="step-title" onclick="toggleStep('step2')">
                    2. Config Network Mode
                </button>
                <div id="step2" class="step-content">
                    <p>Pastikan kedua VM terhubung dalam satu jaringan internal (Host-Only / Internal Network) agar
                        dapat saling berkomunikasi.</p>
                </div>
            </div>

            <div class="step-item">
                <button class="step-title" onclick="toggleStep('step3')">
                    3. Identify Interface
                </button>
                <div id="step3" class="step-content">
                    <p>Cek interface jaringan yang aktif pada Attacker VM:</p>
                    <code
                        style="display:block; padding:8px; background:#f1f5f9; border-radius:4px; margin-top:8px;">ip a</code>
                </div>
            </div>

            <div class="step-item">
                <button class="step-title" onclick="toggleStep('step4')">
                    4. Start Sniffing
                </button>
                <div id="step4" class="step-content">
                    <p>Jalankan <strong>tcpdump</strong> atau buka <strong>Wireshark</strong> untuk mulai menangkap
                        paket pada interface <code>eth0</code>.</p>
                    <code
                        style="display:block; padding:8px; background:#f1f5f9; border-radius:4px; margin-top:8px;">tcpdump -i eth0</code>
                </div>
            </div>

            <div class="step-item">
                <button class="step-title" onclick="toggleStep('step5')">
                    5. Generate Traffic
                </button>
                <div id="step5" class="step-content">
                    <p>Di Victim VM, lakukan aktivitas jaringan seperti <code>ping</code> atau akses web HTTP
                        (non-HTTPS).</p>
                    <code
                        style="display:block; padding:8px; background:#f1f5f9; border-radius:4px; margin-top:8px;">ping 192.168.1.10</code>
                </div>
            </div>

            <div class="step-item">
                <button class="step-title" onclick="toggleStep('step6')">
                    6. Analyze Packet
                </button>
                <div id="step6" class="step-content">
                    <p>Analisis paket yang tertangkap. Perhatikan Source IP, Destination IP, Protocol, dan data payload
                        jika tidak terenkripsi.</p>
                </div>
            </div>

            <div class="step-item">
                <button class="step-title" onclick="toggleStep('step7')">
                    7. Conclusion
                </button>
                <div id="step7" class="step-content">
                    <p>Simpulkan informasi apa saja yang bisa didapatkan dari sniffing traffic yang tidak terenkripsi.
                    </p>
                </div>
            </div>

        </div>
    </aside>

    <!-- RIGHT COLUMN: VM PREVIEW -->
    <main class="lab-main">
        <div class="vm-grid">
            <!-- Sniffer VM -->
            <div class="vm-card">
                <h3 class="card-title">Attacker VM (Sniffer)</h3>
                <div id="attacker-vm-container" class="vm-preview"
                    style="padding: 0; overflow: hidden; height: 600px; display: flex; align-items: center; justify-content: center; background: #f8f9fa;">
                    <div style="text-align: center;">
                        <p style="margin-bottom: 1rem; color: #6c757d;">VM is ready</p>
                    </div>
                </div>
                <div class="actions mt-3 text-center">
                    <button class="btn btn-primary"
                        onclick="startVM('attacker-vm-container', '{{ attacker_url }}', 'sniffing', 'attacker')">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            style="margin-right:8px;">
                            <polygon points="5 3 19 12 5 21 5 3"></polygon>
                        </svg>
                        Start VM
                    </button>
                </div>
            </div>

            <!-- Victim VM -->
            <div class="vm-card">
                <h3 class="card-title">Victim VM (Target)</h3>
                <div id="target-vm-container" class="vm-preview"
                    style="padding: 0; overflow: hidden; height: 600px; display: flex; align-items: center; justify-content: center; background: #f8f9fa;">
                    <div style="text-align: center;">
                        <p style="margin-bottom: 1rem; color: #6c757d;">VM is ready</p>
                    </div>
                </div>
                <div class="actions mt-3 text-center" style="display: flex; gap: 8px; justify-content: center;">
                    <button class="btn btn-primary"
                        onclick="startVM('target-vm-container', '{{ target_url }}', 'sniffing')">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            style="margin-right:8px;">
                            <polygon points="5 3 19 12 5 21 5 3"></polygon>
                        </svg>
                        Start VM
                    </button>
                    <button class="btn btn-warning" onclick="resetVM('sniffing')">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            style="margin-right:8px;">
                            <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path>
                            <path d="M3 3v5h5"></path>
                        </svg>
                        Reset VM
                    </button>
                </div>
            </div>
        </div>

    </main>
</div>
{% endblock %}