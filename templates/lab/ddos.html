{% extends "layout/base.html" %}

{% block title %}DDOS Simulation - Virtual Pen Test Lab{% endblock %}

{% block content %}
<div class="page-header">
    <div class="d-flex justify-content-between align-items-center">
        <div>
            <h1 class="page-title">DDOS Attack Simulation</h1>
            <p class="page-subtitle">Simulasi serangan Distributed Denial of Service (DDoS).</p>
        </div>
        <div class="vm-status status-active">
            Lab Active
        </div>
    </div>
</div>

<div class="lab-layout">
    <!-- LEFT COLUMN: STEPS -->
    <aside class="lab-steps">
        <h3 class="card-title">Guide Instructions</h3>
        <div class="steps-container">

            <div class="step-item">
                <button class="step-title" onclick="toggleStep('step1')">
                    1. Start Virtual Machine
                </button>
                <div id="step1" class="step-content open">
                    <p>Pada tahap ini silahkan hidupkan virtual machine di panel kanan.</p>
                </div>
            </div>

            <div class="step-item">
                <button class="step-title" onclick="toggleStep('step2')">
                    2. Identify Target
                </button>
                <div id="step2" class="step-content">
                    <p>Target yang akan diserang adalah <strong>https.www.asaas.com</strong>.</p>
                </div>
            </div>

            <div class="step-item">
                <button class="step-title" onclick="toggleStep('step3')">
                    3. Check IP Address
                </button>
                <div id="step3" class="step-content">
                    <p>Lakukan pengecekan IP target menggunakan perintah:</p>
                    <code
                        style="display:block; padding:8px; background:#f1f5f9; border-radius:4px; margin-top:8px;">ping website.com</code>
                </div>
            </div>

            <div class="step-item">
                <button class="step-title" onclick="toggleStep('step4')">
                    4. Pre-exploitation
                </button>
                <div id="step4" class="step-content">
                    <p>Gunakan tools <strong>slowhttptest</strong> untuk membanjiri traffic.</p>
                    <p>Run command:</p>
                    <code
                        style="display:block; padding:8px; background:#f1f5f9; border-radius:4px; margin-top:8px; overflow-x:auto;">slowhttptest -c 1000 -H -g -o slowhttp -i 10 -r 200 -t GET -u http://192.168.1.202/index.php -x 24 -p 3</code>
                </div>
            </div>

            <div class="step-item">
                <button class="step-title" onclick="toggleStep('step5')">
                    5. Tool Explanation
                </button>
                <div id="step5" class="step-content">
                    <table style="width:100%; border-collapse: collapse; font-size: 0.85rem;">
                        <tr style="border-bottom: 1px solid var(--border-color);">
                            <th style="text-align:left; padding: 8px;">Param</th>
                            <th style="text-align:left; padding: 8px;">Fungsi</th>
                        </tr>
                        <tr>
                            <td style="padding:4px 8px;">-c 1000</td>
                            <td style="padding:4px 8px;">1000 koneksi</td>
                        </tr>
                        <tr>
                            <td style="padding:4px 8px;">-H</td>
                            <td style="padding:4px 8px;">Slowloris mode</td>
                        </tr>
                        <tr>
                            <td style="padding:4px 8px;">-p 3</td>
                            <td style="padding:4px 8px;">Durasi 3 menit</td>
                        </tr>
                    </table>
                </div>
            </div>

            <div class="step-item">
                <button class="step-title" onclick="toggleStep('step6')">
                    6. Exploitation
                </button>
                <div id="step6" class="step-content">
                    <p>Jalankan perintah serangan dan amati respon server.</p>
                </div>
            </div>

            <div class="step-item">
                <button class="step-title" onclick="toggleStep('step7')">
                    7. Analysis
                </button>
                <div id="step7" class="step-content">
                    <p>Deskripsikan hasil percobaan dan dampaknya pada server.</p>
                </div>
            </div>

        </div>
    </aside>

    <!-- RIGHT COLUMN: VM PREVIEW -->
    <main class="lab-main">
        <div class="vm-grid">
            <!-- Attacker Box -->
            <div class="vm-card">
                <h3 class="card-title">Attacker VM (Kali Linux)</h3>
                <div id="attacker-vm-container" class="vm-preview"
                    style="padding: 0; overflow: hidden; height: 600px; display: flex; align-items: center; justify-content: center; background: #f8f9fa;">
                    <div style="text-align: center;">
                        <p style="margin-bottom: 1rem; color: #6c757d;">VM is ready</p>
                    </div>
                </div>
                <div class="actions mt-3 text-center">
                    <button class="btn btn-primary"
                        onclick="startVM('attacker-vm-container', '{{ attacker_url }}', 'ddos', 'attacker')">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            style="margin-right:8px;">
                            <polygon points="5 3 19 12 5 21 5 3"></polygon>
                        </svg>
                        Start VM
                    </button>
                </div>
            </div>

            <!-- Target Box -->
            <div class="vm-card">
                <h3 class="card-title">Target VM (Server)</h3>
                <div id="target-vm-container" class="vm-preview"
                    style="padding: 0; overflow: hidden; height: 600px; display: flex; align-items: center; justify-content: center; background: #f8f9fa;">
                    <div style="text-align: center;">
                        <p style="margin-bottom: 1rem; color: #6c757d;">VM is ready</p>
                    </div>
                </div>
                <div class="actions mt-3 text-center" style="display: flex; gap: 8px; justify-content: center;">
                    <button class="btn btn-primary"
                        onclick="startVM('target-vm-container', '{{ target_url }}', 'ddos')">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            style="margin-right:8px;">
                            <polygon points="5 3 19 12 5 21 5 3"></polygon>
                        </svg>
                        Start VM
                    </button>
                    <button class="btn btn-warning" onclick="resetVM('ddos')">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            style="margin-right:8px;">
                            <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path>
                            <path d="M3 3v5h5"></path>
                        </svg>
                        Reset VM
                    </button>
                </div>
            </div>
        </div>
    </main>
</div>
{% endblock %}